<!-- order-details.component.html -->
<div class="modal-overlay" *ngIf="modelValue" (click)="onClose()">
  <div class="modal-container" (click)="$event.stopPropagation()">

    <!-- Modal Header -->
    <div class="modal-header">
      <h2 class="modal-title">Order Details</h2>
      <button mat-icon-button (click)="onClose()" class="close-button">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <!-- Modal Content -->
    <div class="modal-content">
      <p class="subtitle">View the details of a registered order.</p>

      <!-- Step 1: Supplies -->
      <div *ngIf="step === 1">
        <div class="section-header">
          <h4 class="section-title">Supplies</h4>
          <p class="section-description">View the supplies you have available for the order.</p>
        </div>

        <div class="table-container">
          <table mat-table [dataSource]="currentSuppliesPerOrder" class="supplies-table">

            <!-- Product Name Column -->
            <ng-container matColumnDef="productName">
              <th mat-header-cell *matHeaderCellDef>Product Name</th>
              <td mat-cell *matCellDef="let element">
                {{ productName(element.supplyId) }}
              </td>
            </ng-container>

            <!-- Quantity Column -->
            <ng-container matColumnDef="quantity">
              <th mat-header-cell *matHeaderCellDef>Quantity</th>
              <td mat-cell *matCellDef="let element">
                {{ element.quantity }}
              </td>
            </ng-container>

            <!-- Unit Measure Column -->
            <ng-container matColumnDef="unitMeasure">
              <th mat-header-cell *matHeaderCellDef>Unit Measure</th>
              <td mat-cell *matCellDef="let element">
                {{ productUnitMeasurement(element.supplyId) }}
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>

          <mat-paginator [pageSize]="4" [pageSizeOptions]="[2, 3, 4]"></mat-paginator>
        </div>

        <div class="total-price">
          <strong>Total Price: ${{ currentOrder.totalPrice }}</strong>
        </div>

        <!-- State Stepper -->
        <div class="state-dragger" *ngIf="!hideState">
          <p class="section-title">State</p>

          <div class="stepper-container">
            <!-- Progress Line -->
            <div class="progress-line">
              <div class="progress-fill" [style.width]="getProgressWidth()"></div>
            </div>

            <!-- Steps -->
            <div class="steps-wrapper">
              <div
                *ngFor="let stepName of steps; let i = index"
                class="step-item"
              >
                <!-- Truck Icon -->
                <div *ngIf="computedCurrentIndex === i" class="truck-container">
                  <mat-icon class="truck-icon">local_shipping</mat-icon>
                </div>

                <!-- Step Point -->
                <div class="step-point" [ngClass]="getStepClass(i)">
                  <mat-icon *ngIf="computedCurrentIndex > i" class="check-icon">check</mat-icon>
                </div>

                <!-- Step Label -->
                <span class="step-label" [class.active]="computedCurrentIndex === i">
                  {{ stepName }}
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Situation Chip -->
        <div class="situation" *ngIf="hideState">
          <p class="situation-label">
            Situation
            <mat-chip class="situation-chip">{{ currentOrderSituation.name || 'Unknown' }}</mat-chip>
          </p>
        </div>
      </div>

      <!-- Step 2: Summary -->
      <div *ngIf="step === 2">
        <div class="restaurant-section">
          <p class="label">Restaurant Name:</p>
          <p class="value">{{ restaurantBusinessName(currentOrder) }}</p>
        </div>

        <div class="date-section">
          <p class="label">Estimated Ship Date and Time:</p>
          <p class="value">{{ formatDate(currentOrder.estimatedShipDate) }}, {{ formatTime(currentOrder.estimatedShipTime) }}</p>
        </div>

        <div class="description-section">
          <p class="label">Order Description</p>
          <p class="value">{{ currentOrder.description }}</p>
        </div>
      </div>
    </div>

    <!-- Modal Footer -->
    <div class="modal-footer">
      <div class="footer-left">
        <button *ngIf="step === 2" mat-button class="btn-back" (click)="prevStep()">
          Back
        </button>
        <button mat-button class="btn-close" (click)="onClose()">
          Close
        </button>
      </div>

      <div class="footer-right">
        <button *ngIf="step === 1" mat-raised-button color="primary" (click)="nextStep()">
          Next
        </button>
      </div>
    </div>

  </div>
</div>
