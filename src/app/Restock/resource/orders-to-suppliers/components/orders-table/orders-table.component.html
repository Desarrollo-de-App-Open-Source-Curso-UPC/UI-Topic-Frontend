<table mat-table [dataSource]="orders" class="mat-elevation-z2">
  <!-- Situation Column -->
  <ng-container matColumnDef="situation">
    <th mat-header-cell *matHeaderCellDef>Situation</th>
    <td mat-cell *matCellDef="let order">{{ order.situation?.name }}</td>
  </ng-container>

  <!-- State Column -->
  <ng-container matColumnDef="state">
    <th mat-header-cell *matHeaderCellDef>State</th>
    <td mat-cell *matCellDef="let order">{{ order.state?.name }}</td>
  </ng-container>

  <!-- Ship Date Column -->
  <ng-container matColumnDef="date">
    <th mat-header-cell *matHeaderCellDef>Ship Date</th>
    <td mat-cell *matCellDef="let order">
      {{ order.date | date : "dd/MM/yy" }}
    </td>
  </ng-container>

  <!-- Supplier Column -->
  <ng-container matColumnDef="supplier">
    <th mat-header-cell *matHeaderCellDef>Supplier</th>
    <td mat-cell *matCellDef="let order">
      {{ getSupplierName(order.supplier_id) }}
    </td>
  </ng-container>

  <!-- Requested Products Column -->
  <ng-container matColumnDef="requestedProducts">
    <th mat-header-cell *matHeaderCellDef>N° Requested Products</th>
    <td mat-cell *matCellDef="let order">{{ order.requested_products }}</td>
  </ng-container>

  <!-- Total Price Column -->
  <ng-container matColumnDef="totalPrice">
    <th mat-header-cell *matHeaderCellDef>Final Price</th>
    <td mat-cell *matCellDef="let order">
      S/. {{ order.total_price.toFixed(2) }}
    </td>
  </ng-container>

  <!-- Actions Column (View Details) -->
  <ng-container matColumnDef="actions">
    <th mat-header-cell *matHeaderCellDef>Actions</th>
    <td mat-cell *matCellDef="let order">
      <div class="action-icons">
        <!-- Ícono de feedback solo si el estado es Delivered -->
        <button
          mat-icon-button
          *ngIf="order.state?.name === 'Delivered'"
          (click)="onFeedback(order)"
        >
          <mat-icon>feedback</mat-icon>
        </button>
        <!-- Reservar espacio si no se muestra -->
        <span
          *ngIf="order.state?.name !== 'Delivered'"
          class="icon-placeholder"
        ></span>

        <!-- Ícono de ver detalles -->
        <button mat-icon-button (click)="onViewDetails(order)">
          <mat-icon>visibility</mat-icon>
        </button>

        <!-- Notificación visible según condición, con espacio reservado -->
        <span
          *ngIf="shouldShowNotification(order); else notificationPlaceholder"
        >
          <mat-icon color="warn">notifications</mat-icon>
        </span>
        <ng-template #notificationPlaceholder>
          <span class="icon-placeholder"></span>
        </ng-template>
      </div>
    </td>
  </ng-container>

  <!-- <ng-container matColumnDef="notifications">
    <th mat-header-cell *matHeaderCellDef></th>
    <td mat-cell *matCellDef="let order">
      <mat-icon color="warn">notifications</mat-icon>
    </td>
  </ng-container> -->

  <!-- Header & Row Declarations -->
  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr
    mat-row
    *matRowDef="let order; columns: displayedColumns"
    [ngClass]="getSituationClass(order.situation?.name)"
    (click)="onRowClick(order)"
  ></tr>
</table>

<ng-template [ngIf]="orders.length === 0">
  <div class="empty-state">
    <mat-icon class="truck-icon">local_shipping</mat-icon>
    <p>
      You currently have no orders registered. Create a new order to start
      managing your purchases and supplies from this section.
    </p>
  </div>
</ng-template>
