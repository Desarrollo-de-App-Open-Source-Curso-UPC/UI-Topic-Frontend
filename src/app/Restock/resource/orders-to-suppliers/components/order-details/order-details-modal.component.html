<ng-template #orderDetailsTemplate>
  <div class="order-modal-container">
    <h2 mat-dialog-title>Detalles de la Orden</h2>

    <mat-dialog-content class="dialog-content">
      <!-- Información general -->
      <div class="section">
        <h3>Información de la Orden</h3>
        <div
          *ngIf="
            order?.state || order?.situation || order?.date;
            else noGeneralInfo
          "
          class="info-grid"
        >
          <p>
            <strong>Estado:</strong>
            {{ order.state?.name || "No especificado" }}
          </p>
          <p>
            <strong>Situación:</strong>
            {{ order.situation?.name || "No especificado" }}
          </p>
          <p>
            <strong>Fecha de Orden:</strong>
            {{ order.date | date : "dd/MM/yyyy" }}
          </p>
          <p>
            <strong>Fecha de Envío Estimada:</strong>
            {{ order.estimated_ship_date | date : "dd/MM/yyyy" }}
          </p>
          <p>
            <strong>Hora Estimada:</strong>
            {{ order.estimated_ship_time | date : "shortTime" }}
          </p>
          <p>
            <strong>Precio Total:</strong> S/.
            {{ order.total_price | number : "1.2-2" }}
          </p>
          <p>
            <strong>Productos Solicitados:</strong>
            {{ order.requested_products_count || "No especificado" }}
          </p>
        </div>
        <ng-template #noGeneralInfo>
          <p>No se encontraron datos de la orden.</p>
        </ng-template>
      </div>

      <mat-divider></mat-divider>

      <!-- Información del proveedor -->
      <div class="section">
        <h3>Proveedor</h3>
        <ng-container *ngIf="providerProfile; else noProvider">
          <div class="provider-info">
            <img
              class="provider-avatar"
              [src]="providerProfile.image"
              alt="Proveedor"
            />
            <div>
              <p>
                <strong
                  >{{ providerProfile.name }}
                  {{ providerProfile.lastName }}</strong
                >
              </p>
              <p>{{ providerProfile.companyName }}</p>
              <p><strong>Teléfono:</strong> {{ providerProfile.phone }}</p>
              <p>
                <strong>Dirección:</strong> {{ providerProfile.companyAddress }}
              </p>
            </div>
          </div>
        </ng-container>
        <ng-template #noProvider>
          <p>No se encontró información del proveedor.</p>
        </ng-template>
      </div>

      <mat-divider></mat-divider>

      <!-- Suministros -->
      <div class="section">
        <h3>Insumos</h3>
        <ng-container *ngIf="hasSupplies; else noSupplies">
          <mat-card
            *ngFor="let supplyRelation of order!.supplies"
            class="supply-card"
          >
            <mat-card-title>{{
              supplyRelation.supply?.name || "Insumo sin nombre"
            }}</mat-card-title>
            <mat-card-content>
              <div class="supply-grid">
                <p>
                  <strong>Descripción:</strong>
                  {{ supplyRelation.supply?.description || "Sin descripción" }}
                </p>
                <p>
                  <strong>Categoría:</strong>
                  {{ supplyRelation.supply?.category?.name || "No definida" }}
                </p>
                <p>
                  <strong>Unidad:</strong>
                  {{
                    supplyRelation.supply?.unit_measurement?.name ||
                      "No definida"
                  }}
                </p>
                <p>
                  <strong>Precio:</strong> S/.
                  {{ supplyRelation.supply?.price ?? "0.00" }}
                </p>
                <p>
                  <strong>Cantidad Solicitada:</strong>
                  {{ supplyRelation.quantity }}
                </p>
                <p>
                  <strong>Aceptado:</strong>
                  {{ supplyRelation.accepted ? "Sí" : "No" }}
                </p>
              </div>
            </mat-card-content>
          </mat-card>
        </ng-container>
        <ng-template #noSupplies>
          <p>No se registraron suministros en esta orden.</p>
        </ng-template>
      </div>
    </mat-dialog-content>

    <mat-dialog-actions align="end">
      <button mat-button mat-dialog-close>Cerrar</button>
    </mat-dialog-actions>
  </div>
</ng-template>
